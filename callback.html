<!-- callback.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Callback</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>body{font-family: Arial, sans-serif;display:flex;align-items:center;justify-content:center;height:100vh}#msg{width:80%;text-align:center}</style>
</head>
<body>
  <div id="msg">Signing you inâ€¦</div>

  <script src="https://cdn.jsdelivr.net/npm/@okta/okta-auth-js@7.8.0/dist/okta-auth-js.min.js"></script>
  <script>
    (async function() {
      try {
        const OKTA_DOMAIN = 'trial-4702613.okta.com'; // e.g. dev-123456.okta.com
        const CLIENT_ID = '0oawflwp5euQKcPIN697';
        const REDIRECT_URI = 'https://custom-spa-okta.vercel.app/callback.html';

        const authClient = new OktaAuth({
          issuer: `https://${OKTA_DOMAIN}/oauth2/default`,
          clientId: CLIENT_ID,
          redirectUri: REDIRECT_URI,
          tokenManager: {
            storage: 'localStorage'
          }
        });

        // Parse the url and exchange the authorization code for tokens
        const tokens = await authClient.token.parseFromUrl();
        // parseFromUrl() returns an object with tokens. For code flow, tokens may be on tokens.tokens
        // If parseFromUrl returns tokens directly:
        if (tokens.tokens) {
          Object.values(tokens.tokens).forEach(token => {
            // tokenManager expects accessToken/idToken
            if (token.accessToken) authClient.tokenManager.add('accessToken', token);
            if (token.idToken) authClient.tokenManager.add('idToken', token);
            if (token.refreshToken) authClient.tokenManager.add('refreshToken', token);
          });
        } else {
          // fallback for some returns
          if (tokens.accessToken) authClient.tokenManager.add('accessToken', tokens);
          if (tokens.idToken) authClient.tokenManager.add('idToken', tokens);
        }

        document.getElementById('msg').innerText = 'Signed in! Redirecting...';
        // Customize: redirect to app home or call your API
        window.location.replace('/');
      } catch (err) {
        console.error('Callback error', err);
        document.getElementById('msg').innerText = 'Sign-in failed. Check console for details.';
      }
    })();
  </script>
</body>
</html>
