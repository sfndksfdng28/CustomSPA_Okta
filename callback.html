<!doctype html>
<html>
<head><meta charset="utf-8"/><title>Callback - Okta</title></head>
<body>
  <h1>Auth callback</h1>
  <div id="status">Processing...</div>
  <pre id="output"></pre>

  <script src="https://global.oktacdn.com/okta-signin-widget/5.7.0/js/okta-sign-in.min.js"></script>
  <script>
    const OKTA_DOMAIN = "https://dev-123456.okta.com"; // replace
    const CLIENT_ID = "0oabEXAMPLEID";                 // replace
    const ISSUER = OKTA_DOMAIN + '/oauth2/default';

    const signIn = new OktaSignIn({
      baseUrl: OKTA_DOMAIN,
      clientId: CLIENT_ID,
      redirectUri: window.location.origin + '/callback.html',
      authParams: { issuer: ISSUER, responseType: ['code'], scopes: ['openid','profile','email'] }
    });

    // The widget's authClient can parse tokens from the URL after redirect.
    const authClient = signIn.authClient;

    authClient.token.parseFromUrl()
      .then(function(tokenResponse) {
        // For code flow with PKCE, modern Okta SDKs will exchange code for tokens automatically.
        // tokenResponse will contain tokens if using implicit; for explicit PKCE exchange use token.exchangeCodeForTokens()
        document.getElementById('status').textContent = 'Parsed token response. Opening userinfo...';
        // Try to get userinfo if we have an access token
        const accessToken = tokenResponse.tokens?.accessToken?.accessToken || tokenResponse.accessToken;
        const idToken = tokenResponse.tokens?.idToken?.idToken || tokenResponse.idToken;
        const out = { idToken, accessToken };
        document.getElementById('output').textContent = JSON.stringify(out, null, 2);
      })
      .catch(function(err) {
        document.getElementById('status').textContent = 'Error parsing tokens: see console';
        console.error(err);
        document.getElementById('output').textContent = String(err);
      });
  </script>
</body>
</html>
